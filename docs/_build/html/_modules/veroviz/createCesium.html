
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>veroviz.createCesium &#8212; veroviz 0.3.0 documentation</title>
    <link rel="stylesheet" href="../../_static/lglb-sphinx-doc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
<div class="header">
 <p class="logo"><a href="https://veroviz.org">
  <img class="logo" src="../../_static/optimator_lab_transparency_small.png" alt="Logo"/>
 </a></p>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">veroviz 0.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../veroviz.html" accesskey="U">veroviz</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for veroviz.createCesium</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">veroviz._common</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">veroviz._validation</span> <span class="k">import</span> <span class="n">valCreateCesium</span>

<span class="kn">from</span> <span class="nn">veroviz._deconstructAssignments</span> <span class="k">import</span> <span class="n">deconstructAssignments</span>
<span class="kn">from</span> <span class="nn">veroviz._internal</span> <span class="k">import</span> <span class="n">delTailSlash</span>
<span class="kn">from</span> <span class="nn">veroviz._internal</span> <span class="k">import</span> <span class="n">delHeadSlash</span>
<span class="kn">from</span> <span class="nn">veroviz._internal</span> <span class="k">import</span> <span class="n">addHeadSlash</span>
<span class="kn">from</span> <span class="nn">veroviz._internal</span> <span class="k">import</span> <span class="n">replaceBackslashToSlash</span>

<span class="kn">from</span> <span class="nn">veroviz.utilities</span> <span class="k">import</span> <span class="n">getMapBoundary</span>
<span class="kn">from</span> <span class="nn">veroviz.utilities</span> <span class="k">import</span> <span class="n">exportDataframe</span>

<div class="viewcode-block" id="createCesium"><a class="viewcode-back" href="../../veroviz.createCesium.html#veroviz.createCesium.createCesium">[docs]</a><span class="k">def</span> <span class="nf">createCesium</span><span class="p">(</span><span class="n">assignments</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">startDate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">startTime</span><span class="o">=</span><span class="s1">&#39;08:00:00&#39;</span><span class="p">,</span> <span class="n">postBuffer</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">cesiumDir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">problemDir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodeColor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodeStyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pathColor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pathWeight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pathStyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pathOpacity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This function generates several files required to view a solution in Cesium. The function requires assignments and/or nodes dataframes as input. </span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	assignments: :ref:`Assignments`, Conditional, `assignments` and `nodes` can not be None at the same time</span>
<span class="sd">		An :ref:`Assignments` dataframe describing vehicle movement over time.  The assignments will be displayed as routes/paths in Cesium.  If a 3D model is defined in the `modelFile` column of the assignments dataframe, this object will also be displayed.</span>
<span class="sd">	nodes: :ref:`Nodes`, Conditional, `assignments` and `nodes` can not be None at the same time</span>
<span class="sd">		A :ref:`Nodes` dataframe describing the locations of nodes.  These nodes will be displayed on the map in Cesium.  </span>
<span class="sd">	startDate: string, Optional, format is &quot;YYYY-MM-DD&quot;, default as today</span>
<span class="sd">		Defines the start date to be displayed in Cesium.</span>
<span class="sd">	startTime: string, Optional, format is &quot;HH:MM:SS&quot;, default as &#39;08:00:00&#39;</span>
<span class="sd">		Defines the time at which the Cesium video begins, on the start date.</span>
<span class="sd">	postBuffer: int, Optional, default as 30</span>
<span class="sd">		Specifies the additional time (in seconds) that the Cesium video will continue to run after the last assignment is completed. </span>
<span class="sd">	cesiumDir: string, Required, default as None</span>
<span class="sd">		This should be the full absolute path to the directory where Cesium is installed. For example, for Windows it might be &quot;D:/Cesium&quot;; for Linux it might be &quot;/home/user/Cesium&quot;.</span>
<span class="sd">	problemDir: string, Required, default as None</span>
<span class="sd">		The path name of the generated problem directory. This path is relative to the root of Cesium. For example, if `cesiumDir = &#39;/home/user/Cesium&#39;` and `problemDir = &#39;veroviz/problems/TSP&#39;` then the files will be generated in the directory `&#39;/home/user/Cesium/veroviz/problems/TSP&#39;`.</span>
<span class="sd">	nodeColor: string, Optional, default as None</span>
<span class="sd">		Overrides the `cesiumColor` column of the input `nodes` dataframe.  This will define the color of all nodes displayed in Cesium.  See :ref:`Cesium Style` for the collection of available colors. </span>
<span class="sd">	nodeStyle: string, Optional, default as None</span>
<span class="sd">		Overrides the `cesiumIconType` column of the input `nodes` dataframe.  Currently, the only option is &#39;pin&#39;.</span>
<span class="sd">	pathColor: string, Optional, default as None</span>
<span class="sd">		Overrides the `cesiumColor` column of the input `assignments` dataframe.  This will define the color of all arcs displayed in Cesium.  See :ref:`Cesium Style` for the collection of available colors.</span>
<span class="sd">	pathWeight: int, Optional, default as None</span>
<span class="sd">		Overrides the `cesiumWeight` column of the input `assignments` dataframe. This will define the weight (in pixels) of all arcs displayed in Cesium. See :ref:`Cesium Style` for more information.</span>
<span class="sd">	pathStyle: string, Optional, default as None</span>
<span class="sd">		Overrides the `cesiumStyle` column of the input `assignments` dataframe. This will define the style of all arcs displayed in Cesium. See :ref:`Cesium Style` for available options.</span>
<span class="sd">	pathOpacity: float in [0, 1], Optional, default as None</span>
<span class="sd">		Overrides the `cesiumOpacity` column of the input `assignments` dataframe.  This will define the opacity of all arcs displayed in Cesium.  See :ref:`Cesium Style` for more information.</span>

<span class="sd">	Return</span>
<span class="sd">	------</span>
<span class="sd">	N/A</span>

<span class="sd">	Note</span>
<span class="sd">	----</span>
<span class="sd">	This function generates the following files within the directory specified by input argument `problemDir`:</span>

<span class="sd">	- [problemDir].vrv (where [problemDir] is replaced by the value of `problemDir`);</span>
<span class="sd">	- config.js</span>
<span class="sd">	- displayNodes.js</span>
<span class="sd">	- displayPath.js</span>
<span class="sd">	- routes.czml</span>

<span class="sd">	Instructions for starting Cesium are provided at https://veroviz.org/documentation.html</span>

<span class="sd">	Example</span>
<span class="sd">	--------</span>
<span class="sd">	Import veroviz and check the latest version.</span>
<span class="sd">		&gt;&gt;&gt; import veroviz as vrv</span>
<span class="sd">		&gt;&gt;&gt; import os</span>

<span class="sd">		&gt;&gt;&gt; vrv.checkVersion()</span>
<span class="sd">		</span>
<span class="sd">	Create two nodes.</span>
<span class="sd">		&gt;&gt;&gt; myNodes = vrv.createNodesFromLocs(</span>
<span class="sd">		...     locs = [[42.1538, -78.4253],</span>
<span class="sd">		...             [42.6343, -78.1146]])</span>
<span class="sd">		&gt;&gt;&gt; myNodes</span>

<span class="sd">	Move the truck from one node to the other.</span>
<span class="sd">		&gt;&gt;&gt; myAssignments = vrv.getShapepoints2D(</span>
<span class="sd">		...     odID           = 0,</span>
<span class="sd">		...     objectID       = &#39;truck&#39;,</span>
<span class="sd">		...     modelFile      = &#39;veroviz/models/ub_truck.gltf&#39;,</span>
<span class="sd">		...     modelScale     = 80, </span>
<span class="sd">		...     modelMinPxSize = 20, </span>
<span class="sd">		...     startLoc       = list(myNodes.loc[0][[&#39;lat&#39;, &#39;lon&#39;]].values),</span>
<span class="sd">		...     endLoc         = list(myNodes.loc[1][[&#39;lat&#39;, &#39;lon&#39;]].values),</span>
<span class="sd">		...     routeType      = &#39;euclidean2D&#39;,</span>
<span class="sd">		...     dataProvider   = None,</span>
<span class="sd">		...     speedMPS       = vrv.convertSpeed(55, &#39;miles&#39;, &#39;hr&#39;, &#39;m&#39;, &#39;s&#39;))	</span>
<span class="sd">		</span>
<span class="sd">	Create Cesium output.</span>
<span class="sd">		&gt;&gt;&gt; vrv.createCesium(</span>
<span class="sd">		...     assignments = myAssignments, </span>
<span class="sd">		...     nodes       = myNodes, </span>
<span class="sd">		...     startTime   = &#39;08:00:00&#39;, </span>
<span class="sd">		...     cesiumDir   = os.environ[&#39;CESIUMDIR&#39;],</span>
<span class="sd">		...     problemDir  = &#39;createCesium_example&#39;)</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1"># validation</span>
	<span class="p">[</span><span class="n">valFlag</span><span class="p">,</span> <span class="n">errorMsg</span><span class="p">,</span> <span class="n">warningMsg</span><span class="p">]</span> <span class="o">=</span> <span class="n">valCreateCesium</span><span class="p">(</span><span class="n">assignments</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">startDate</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">postBuffer</span><span class="p">,</span> <span class="n">cesiumDir</span><span class="p">,</span> <span class="n">problemDir</span><span class="p">,</span> <span class="n">nodeColor</span><span class="p">,</span> <span class="n">pathColor</span><span class="p">,</span> <span class="n">pathWeight</span><span class="p">,</span> <span class="n">pathStyle</span><span class="p">,</span> <span class="n">pathOpacity</span><span class="p">)</span>
	<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">valFlag</span><span class="p">):</span>
		<span class="nb">print</span> <span class="p">(</span><span class="n">errorMsg</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="k">elif</span> <span class="p">(</span><span class="n">VRV_SETTING_SHOWWARNINGMESSAGE</span> <span class="ow">and</span> <span class="n">warningMsg</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
		<span class="nb">print</span> <span class="p">(</span><span class="n">warningMsg</span><span class="p">)</span>

	<span class="c1"># Set default start date as today</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">startDate</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
		<span class="n">startDate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>

	<span class="c1"># Some modification about slashes:</span>
	<span class="c1"># cesiumDir - no tail slash</span>
	<span class="c1"># problemDir - no head slash and no tail slash</span>
	<span class="c1"># Change all backslash to slash</span>
	<span class="n">cesiumDir</span> <span class="o">=</span> <span class="n">delTailSlash</span><span class="p">(</span><span class="n">cesiumDir</span><span class="p">)</span>
	<span class="n">problemDir</span> <span class="o">=</span> <span class="n">delTailSlash</span><span class="p">(</span><span class="n">problemDir</span><span class="p">)</span>
	<span class="n">problemDir</span> <span class="o">=</span> <span class="n">delHeadSlash</span><span class="p">(</span><span class="n">problemDir</span><span class="p">)</span>
	<span class="n">cesiumDir</span> <span class="o">=</span> <span class="n">replaceBackslashToSlash</span><span class="p">(</span><span class="n">cesiumDir</span><span class="p">)</span>
	<span class="n">problemDir</span> <span class="o">=</span> <span class="n">replaceBackslashToSlash</span><span class="p">(</span><span class="n">problemDir</span><span class="p">)</span>

	<span class="c1"># In case the problemDir does not exist</span>
	<span class="n">fullDir</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cesiumDir</span><span class="p">,</span> <span class="n">problemDir</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fullDir</span><span class="p">):</span>
		<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">fullDir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

	<span class="c1"># Mission duration, from time zero to endtime+postBuffer</span>
	<span class="n">availStart</span> <span class="o">=</span> <span class="n">_getCesiumTime</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="n">availEnd</span>   <span class="o">=</span> <span class="n">_getCesiumTime</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">assignments</span><span class="p">[</span><span class="s1">&#39;endTimeSec&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">postBuffer</span><span class="p">))</span>

	<span class="c1"># Decode Assignments dataframe to a Path dataframe (with details of a path) and a list of Assignments dataframes, and generate .js and .czml files</span>
	<span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">lstSubAssignments</span><span class="p">]</span> <span class="o">=</span> <span class="n">_getPathsDetails</span><span class="p">(</span><span class="n">assignments</span><span class="p">)</span>
	<span class="n">lstNonStationarySubAssignments</span> <span class="o">=</span> <span class="n">deconstructAssignments</span><span class="p">(</span><span class="n">assignments</span><span class="o">=</span><span class="n">assignments</span><span class="p">,</span> <span class="n">includeVerticalFlag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

	<span class="c1"># Update &#39;intervalStart&#39; and &#39;intervalEnd&#39; to cesiumTime</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
		<span class="n">path</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;intervalStart&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_getCesiumTime</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;startTimeSec&#39;</span><span class="p">])</span>
		<span class="n">path</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;intervalEnd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_getCesiumTime</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">path</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;endTimeSec&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;endTimeSec&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">else</span> <span class="n">availEnd</span>
	<span class="n">path</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;startTimeSec&#39;</span><span class="p">,</span> <span class="s1">&#39;endTimeSec&#39;</span><span class="p">])</span>

	<span class="c1"># Write problem selector</span>
	<span class="n">_writeSelector</span><span class="p">(</span><span class="n">fullDir</span><span class="p">,</span> <span class="n">problemDir</span><span class="p">)</span>

	<span class="c1"># Write Configs</span>
	<span class="n">mapBoundary</span> <span class="o">=</span> <span class="n">getMapBoundary</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span> <span class="n">arcs</span><span class="o">=</span><span class="n">assignments</span><span class="p">,</span> <span class="n">locs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
	<span class="n">_writeConfigs</span><span class="p">(</span><span class="n">mapBoundary</span><span class="p">,</span> <span class="n">availStart</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">fullDir</span><span class="p">,</span> <span class="n">problemDir</span><span class="p">)</span>

	<span class="c1"># Write Nodes</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">nodes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
		<span class="n">_writeNodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">nodeColor</span><span class="p">,</span> <span class="n">fullDir</span><span class="p">)</span>

	<span class="c1"># Write Assignments</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
		<span class="n">_writeAssignmentsJS</span><span class="p">(</span><span class="n">lstNonStationarySubAssignments</span><span class="p">,</span> <span class="n">pathColor</span><span class="p">,</span> <span class="n">pathWeight</span><span class="p">,</span> <span class="n">pathStyle</span><span class="p">,</span> <span class="n">pathOpacity</span><span class="p">,</span> <span class="n">fullDir</span><span class="p">)</span>
		<span class="n">_writeAssignmentsCZML</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">lstSubAssignments</span><span class="p">,</span> <span class="n">availStart</span><span class="p">,</span> <span class="n">availEnd</span><span class="p">,</span> <span class="n">fullDir</span><span class="p">)</span>

	<span class="k">return</span></div>

<span class="k">def</span> <span class="nf">_writeSelector</span><span class="p">(</span><span class="n">fullDir</span><span class="p">,</span> <span class="n">problemDir</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This script generates a .vrv file, in index.html, load [problemDir].vrv to load the other files</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	fullDir: string</span>
<span class="sd">		The directory of cesium, including the name of the instance.</span>
<span class="sd">	problemDir: string</span>
<span class="sd">		The name of the instance</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1"># Replace &quot;/&quot; with &quot;;&quot;</span>
	<span class="n">replacedDir</span> <span class="o">=</span> <span class="n">addHeadSlash</span><span class="p">(</span><span class="n">problemDir</span><span class="p">)</span>
	<span class="n">replacedDir</span> <span class="o">=</span> <span class="n">replacedDir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">)</span>

	<span class="c1"># .vrv file path</span>
	<span class="n">vrvFilePath</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">.vrv&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullDir</span><span class="p">,</span> <span class="n">replacedDir</span><span class="p">)</span>
	<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">vrvFilePath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

	<span class="n">vrvStr</span> <span class="o">=</span> <span class="s2">&quot;~</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vrvStr</span><span class="p">)</span>
	<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">VRV_SETTING_SHOWOUTPUTMESSAGE</span><span class="p">):</span>
		<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Message: File selector was written to </span><span class="si">%s</span><span class="s2"> ...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">vrvFilePath</span><span class="p">))</span>

	<span class="k">return</span>

<span class="k">def</span> <span class="nf">_writeConfigs</span><span class="p">(</span><span class="n">mapBoundary</span><span class="p">,</span> <span class="n">availStart</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">fullDir</span><span class="p">,</span> <span class="n">problemDir</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This script generates config.js file</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	mapBoundary: list, the format is [minLon, minLat, maxLon, maxLat]</span>
<span class="sd">		The boundary of the map</span>
<span class="sd">	availStart: JulianDate</span>
<span class="sd">		The start time of entire routing visualization</span>
<span class="sd">	path: dataframe</span>
<span class="sd">		A list of detail information from `_getPathsDetails()`</span>
<span class="sd">	modelIDs: list</span>
<span class="sd">		`model` column from path dataframe</span>
<span class="sd">	actions: list</span>
<span class="sd">		`action` column from path dataframe</span>
<span class="sd">	fullDir: string</span>
<span class="sd">		The directory of cesium, including the name of the instance.</span>
<span class="sd">	problemDir: string</span>
<span class="sd">		The name of the instance</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="c1"># Decode</span>
	<span class="n">allIDs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;czmlID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
	<span class="n">orientationIDs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="s1">&#39;czmlID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
	<span class="p">[[</span><span class="n">minLat</span><span class="p">,</span> <span class="n">maxLon</span><span class="p">],</span> <span class="p">[</span><span class="n">maxLat</span><span class="p">,</span> <span class="n">minLon</span><span class="p">]]</span> <span class="o">=</span> <span class="n">mapBoundary</span>

	<span class="c1"># .js file path</span>
	<span class="n">jsFilePath</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/config.js&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullDir</span><span class="p">)</span>
	<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsFilePath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

	<span class="c1"># Head description</span>
	<span class="n">jsStr</span>  <span class="o">=</span>         <span class="s2">&quot;// This .js file is auto-generated by `createCesium()` from VeRoViz</span><span class="se">\n</span><span class="s2">&quot;</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;// The configs for cesium application go to here</span><span class="se">\n\n</span><span class="s2">&quot;</span>

	<span class="c1"># Configuration and load czml file, runRoutes() is defined in index.html</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;function setConfigs() {</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="c1"># Set map boundary</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;    viewer.camera.flyTo({</span><span class="se">\n</span><span class="s2">&quot;</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;        destination: Cesium.Rectangle.fromDegrees(</span><span class="si">%f</span><span class="s2">, </span><span class="si">%f</span><span class="s2">, </span><span class="si">%f</span><span class="s2">, </span><span class="si">%f</span><span class="s2">) </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">minLon</span><span class="p">,</span> <span class="n">minLat</span><span class="p">,</span> <span class="n">maxLon</span><span class="p">,</span> <span class="n">maxLat</span><span class="p">)</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;    });</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="c1"># Set clock</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;    viewer.clock.currentTime = Cesium.JulianDate.addSeconds(&#39;</span><span class="si">%s</span><span class="s2">&#39;, 0, new Cesium.JulianDate());</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">availStart</span><span class="p">)</span>

	<span class="c1"># allIDs and orientationIDs</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;    allIDs = [</span><span class="se">\n</span><span class="s2">&quot;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">allIDs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">allIDs</span><span class="p">)):</span>
			<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;        &#39;</span><span class="si">%s</span><span class="s2">&#39;, </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">allIDs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="n">jsStr</span> <span class="o">=</span> <span class="n">jsStr</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
		<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;    </span><span class="se">\n</span><span class="s2">&quot;</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;    ];</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;    orientationIDs = [</span><span class="se">\n</span><span class="s2">&quot;</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">orientationIDs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">orientationIDs</span><span class="p">)):</span>
			<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;        &#39;</span><span class="si">%s</span><span class="s2">&#39;, </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">orientationIDs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="n">jsStr</span> <span class="o">=</span> <span class="n">jsStr</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
		<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;    </span><span class="se">\n</span><span class="s2">&quot;</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;    ];</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="c1"># load .czml, `runRoutes()` are writen in index.html </span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;    czmlRouteFile = &#39;</span><span class="si">%s</span><span class="s2">/routes.czml&#39;;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">problemDir</span><span class="p">)</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;    runRoutes(czmlRouteFile, allIDs, orientationIDs);</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="c1"># Get all unrepeated objectID, modelID, child model</span>
	<span class="c1"># The hierarchy is: objectID (one) - modelID (many), modelID (one) - child model (many)</span>
	<span class="c1"># E.g., For drones</span>
	<span class="c1"># objectID - UAV, </span>
	<span class="c1"># model - UAV-drone.gltf; UAV-drone_package.gltf, </span>
	<span class="c1"># child model - &#39;o-UAV-drone_package.gltf-move&#39;; &#39;o-UAV-drone_package.gltf-vertical&#39;; &#39;o-UAV-drone_package.gltf-stationary&#39;</span>
	<span class="n">objectIDs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;objectID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">objectIDs</span><span class="p">)):</span>
		<span class="n">models</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;objectID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">objectIDs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;modelFile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">)):</span>
			<span class="n">childModels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;objectID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">objectIDs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;modelFile&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">models</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="s1">&#39;action&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
			<span class="n">strChildModels</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
			<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">childModels</span><span class="p">)):</span>
				<span class="n">strChildModels</span> <span class="o">+=</span> <span class="s2">&quot;&#39;o-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">objectIDs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">models</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">childModels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">strChildModels</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
				<span class="n">strChildModels</span> <span class="o">=</span> <span class="n">strChildModels</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
			<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;objectInfo[&#39;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&#39;] = {</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">objectIDs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">models</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
			<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;    label : &#39;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&#39;, </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">objectIDs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">models</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
			<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;    childModels : [</span><span class="si">%s</span><span class="s2">],</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">strChildModels</span><span class="p">)</span>
			<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;    scale : </span><span class="si">%s</span><span class="s2">, </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;objectID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">objectIDs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;modelFile&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">models</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="s1">&#39;modelScale&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;    minPxSize : </span><span class="si">%s</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span>  <span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;objectID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">objectIDs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;modelFile&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">models</span><span class="p">[</span><span class="n">j</span><span class="p">]),</span> <span class="s1">&#39;modelMinPxSize&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;}; </span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="c1"># Register objects</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;    registerObjects(objectInfo); </span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="c1"># End of the displayPaths function</span>
	<span class="n">jsStr</span> <span class="o">+=</span>         <span class="s2">&quot;}&quot;</span>

	<span class="c1"># Write contents and close file stream</span>
	<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">jsStr</span><span class="p">)</span>
	<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">VRV_SETTING_SHOWOUTPUTMESSAGE</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Message: Configs were written to </span><span class="si">%s</span><span class="s2"> ...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">jsFilePath</span><span class="p">))</span>

	<span class="k">return</span>

<span class="k">def</span> <span class="nf">_writeNodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">cesiumIconColor</span><span class="p">,</span> <span class="n">fullDir</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This script generates displayNodes.js file</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	nodes: :ref:`Nodes`</span>
<span class="sd">		Nodes to be appeared in cesium</span>
<span class="sd">	cesiumIconColor: string</span>
<span class="sd">		The color of nodes when displayed in Cesium. If provided, it will overrides the color in nodes dataframe. One of a collection of pre-specified colors. See :ref:`Cesium Style`</span>
<span class="sd">	fullDir: string</span>
<span class="sd">		The directory of cesium, including the name of the instance.	</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1"># .js file path</span>
	<span class="n">jsFilePath</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/displayNodes.js&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullDir</span><span class="p">)</span>
	<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsFilePath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

	<span class="c1"># Head description</span>
	<span class="n">jsStr</span>  <span class="o">=</span>     <span class="s2">&quot;// This .js file is auto-generated by `createCesium()` from VeRoViz</span><span class="se">\n</span><span class="s2">&quot;</span>
	<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;// Display nodes for cesium application</span><span class="se">\n\n</span><span class="s2">&quot;</span>

	<span class="c1"># In case some there is skipped index</span>
	<span class="n">indNodes</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

	<span class="c1"># Display the nodes</span>
	<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;function displayNodes() {</span><span class="se">\n</span><span class="s2">&quot;</span>
	<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;    var pin = new Array;</span><span class="se">\n</span><span class="s2">&quot;</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">indNodes</span><span class="p">)):</span>
		<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;    pin[</span><span class="si">%s</span><span class="s2">] = viewer.entities.add({</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
		<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;        name : &#39;</span><span class="si">%s</span><span class="s2">&#39;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indNodes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cesiumIconText&#39;</span><span class="p">])</span>
		<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;        position : Cesium.Cartesian3.fromDegrees(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">),</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indNodes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">indNodes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;lat&#39;</span><span class="p">])</span>
		<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;        billboard : {</span><span class="se">\n</span><span class="s2">&quot;</span>
		<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;            image : pinBuilder.fromText(&#39;</span><span class="si">%s</span><span class="s2">&#39;, </span><span class="si">%s</span><span class="s2">, 40).toDataURL(),</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indNodes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">cesiumIconColor</span> <span class="k">if</span> <span class="p">(</span><span class="n">cesiumIconColor</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">indNodes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;cesiumColor&#39;</span><span class="p">])</span>
		<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;            verticalOrigin : Cesium.VerticalOrigin.BOTTOM</span><span class="se">\n</span><span class="s2">&quot;</span>
		<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;        }</span><span class="se">\n</span><span class="s2">&quot;</span>
		<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;    });</span><span class="se">\n\n</span><span class="s2">&quot;</span>
	<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;}&quot;</span>

	<span class="c1"># Write contents and close file stream</span>
	<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">jsStr</span><span class="p">)</span>
	<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">VRV_SETTING_SHOWOUTPUTMESSAGE</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Message: Nodes were written to </span><span class="si">%s</span><span class="s2"> ...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">jsFilePath</span><span class="p">))</span>

	<span class="k">return</span>

<span class="k">def</span> <span class="nf">_writeAssignmentsCZML</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">lstSubAssignments</span><span class="p">,</span> <span class="n">availStart</span><span class="p">,</span> <span class="n">availEnd</span><span class="p">,</span> <span class="n">fullDir</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This script generates routes.czml file</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	path: path dataframe</span>
<span class="sd">		A list of &quot;path&quot;, defines the details of each sub-assignments. Each &quot;path&quot; has an origin coordinate and a destinate coordinate, represent a group of assignments (a sub-assignment) with same odID</span>
<span class="sd">	lstSubAssignments: list of :ref:`Assignments`</span>
<span class="sd">		A list of Assignments dataframe, each dataframe will have the same odID</span>
<span class="sd">	availStart: JulianDate</span>
<span class="sd">		Start time of entire .czml file</span>
<span class="sd">	availEnd: JulianDate</span>
<span class="sd">		End time of entire .czml file</span>
<span class="sd">	fullDir: string</span>
<span class="sd">		The directory of cesium, including the name of the instance.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1"># .czml file path</span>
	<span class="n">czmlFilePath</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/routes.czml&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullDir</span><span class="p">)</span>
	<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">czmlFilePath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

	<span class="c1"># Group the path, so that the path with the same czmlID can ends up with the same block</span>
	<span class="n">czmlIDList</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="s1">&#39;czmlID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
	<span class="n">czmlIDList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">czmlIDList</span><span class="p">))</span>
	<span class="n">lstCzml</span> <span class="o">=</span> <span class="p">[]</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">czmlIDList</span><span class="p">)):</span>
		<span class="n">lstCzml</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">path</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">path</span><span class="p">[</span><span class="s1">&#39;czmlID&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">czmlIDList</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

	<span class="c1"># Head of CZML file (can&#39;t comment on .czml file so there is no head description)</span>
	<span class="n">czmlStr</span>  <span class="o">=</span>                 <span class="s1">&#39;[ </span><span class="se">\n</span><span class="s1">&#39;</span>
	<span class="n">czmlStr</span> <span class="o">+=</span>                 <span class="s1">&#39;{ </span><span class="se">\n</span><span class="s1">&#39;</span>
	<span class="n">czmlStr</span> <span class="o">+=</span>                 <span class="s1">&#39;    &quot;id&quot;: &quot;document&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span>
	<span class="n">czmlStr</span> <span class="o">+=</span>                 <span class="s1">&#39;    &quot;version&quot;: &quot;1.0&quot; </span><span class="se">\n</span><span class="s1">&#39;</span>
	<span class="n">czmlStr</span> <span class="o">+=</span>                 <span class="s1">&#39;}, </span><span class="se">\n</span><span class="s1">&#39;</span>

	<span class="c1"># For each combination of &#39;objectID&#39;, &#39;modelFile&#39;. &#39;action&#39;, we have a section (in fact we treat a combination of those three fields as unique &#39;odID&#39;)</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lstCzml</span><span class="p">)):</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;{ </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;    &quot;id&quot;: &quot;</span><span class="si">%s</span><span class="s1">&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">czmlIDList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;    &quot;name&quot;: &quot;</span><span class="si">%s</span><span class="s1">&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">czmlIDList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;    &quot;availability&quot;: &quot;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">availStart</span><span class="p">,</span> <span class="n">availEnd</span><span class="p">)</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;    &quot;model&quot;: { </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;show&quot;: true, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;gltf&quot;: &quot;</span><span class="si">%s</span><span class="s1">&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;modelFile&#39;</span><span class="p">])</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;scale&quot;: </span><span class="si">%d</span><span class="s1">, </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;modelScale&#39;</span><span class="p">]</span><span class="o">/</span><span class="mf">100.0</span><span class="p">)</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;minimumPixelSize&quot;: </span><span class="si">%d</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;modelMinPxSize&#39;</span><span class="p">])</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;    }, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;    &quot;label&quot;: { </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;fillColor&quot;:[{&quot;rgba&quot;:[255,255,0,255]}], </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;font&quot;:&quot;bold 10pt Segoe UI Semibold&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;horizontalOrigin&quot;:&quot;LEFT&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;outlineColor&quot;:{&quot;rgba&quot;:[0,0,0,255]}, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;pixelOffset&quot;:{&quot;cartesian2&quot;:[10.0,0.0]}, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;scale&quot;:1.0, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;show&quot;:[{&quot;boolean&quot;:false}], </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;style&quot;:&quot;FILL&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;text&quot;:&quot;Object </span><span class="si">%s</span><span class="s1">&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;objectID&#39;</span><span class="p">])</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;verticalOrigin&quot;:&quot;BOTTOM&quot;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;    }, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;    &quot;path&quot;:{ </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;material&quot;:{&quot;solidColor&quot;:{&quot;color&quot;:{&quot;rgba&quot;:[255,255,0,255]}}}, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;width&quot;:[{&quot;number&quot;:2.0}], </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;        &quot;show&quot;:[{&quot;boolean&quot;:false}] </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;    }, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;    &quot;position&quot;: [ </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;stationary&quot;</span><span class="p">):</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;        { </span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;            &quot;interval&quot;: &quot;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;intervalStart&#39;</span><span class="p">],</span> <span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;intervalEnd&#39;</span><span class="p">])</span>
				<span class="n">lat</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;startLat&#39;</span><span class="p">]</span>
				<span class="n">lon</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;startLon&#39;</span><span class="p">]</span>
				<span class="n">alt</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;startAltMeters&#39;</span><span class="p">]</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;            &quot;cartographicDegrees&quot;: [</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">] </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">alt</span><span class="p">)</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;        }, </span><span class="se">\n</span><span class="s1">&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;        { </span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;            &quot;interval&quot;: &quot;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">&quot;,</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;intervalStart&#39;</span><span class="p">],</span> <span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;intervalEnd&#39;</span><span class="p">])</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;            &quot;interpolationAlgorithm&quot;:&quot;LAGRANGE&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;            &quot;interpolationDegree&quot;: 1, </span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;            &quot;epoch&quot;: &quot;</span><span class="si">%s</span><span class="s1">&quot;, </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">availStart</span><span class="p">)</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;            &quot;cartographicDegrees&quot;: [ </span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="c1"># There will be a list of LLA</span>
				<span class="n">time</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">]][</span><span class="s1">&#39;startTimeSec&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
				<span class="n">lats</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">]][</span><span class="s1">&#39;startLat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
				<span class="n">lons</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">]][</span><span class="s1">&#39;startLon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
				<span class="n">alts</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">]][</span><span class="s1">&#39;startAltMeters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
				<span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lats</span><span class="p">)):</span>
					<span class="n">czmlStr</span> <span class="o">+=</span> <span class="s1">&#39;                </span><span class="si">%.2f</span><span class="s1">, </span><span class="si">%f</span><span class="s1">, </span><span class="si">%f</span><span class="s1">, </span><span class="si">%f</span><span class="s1">, </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lons</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">alts</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
				<span class="n">lastTime</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;endTimeSec&#39;</span><span class="p">]</span>
				<span class="n">lastLat</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;endLat&#39;</span><span class="p">]</span>
				<span class="n">lastLon</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;endLon&#39;</span><span class="p">]</span>
				<span class="n">lastAlt</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">lstCzml</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;endAltMeters&#39;</span><span class="p">]</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;                </span><span class="si">%.2f</span><span class="s1">, </span><span class="si">%f</span><span class="s1">, </span><span class="si">%f</span><span class="s1">, </span><span class="si">%f</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lastTime</span><span class="p">,</span> <span class="n">lastLon</span><span class="p">,</span> <span class="n">lastLat</span><span class="p">,</span> <span class="n">lastAlt</span><span class="p">)</span>

				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;            ] </span><span class="se">\n</span><span class="s1">&#39;</span>
				<span class="n">czmlStr</span> <span class="o">+=</span>     <span class="s1">&#39;        }, </span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">=</span> <span class="n">czmlStr</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;    ]</span><span class="se">\n</span><span class="s1">&#39;</span>
		<span class="n">czmlStr</span> <span class="o">+=</span>             <span class="s1">&#39;}, </span><span class="se">\n</span><span class="s1">&#39;</span>
	<span class="n">czmlStr</span> <span class="o">=</span> <span class="n">czmlStr</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
	<span class="n">czmlStr</span> <span class="o">+=</span>                 <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

	<span class="c1"># Closing bracket for entire .czml file</span>
	<span class="n">czmlStr</span> <span class="o">+=</span>                 <span class="s1">&#39;]&#39;</span>

	<span class="c1"># Write contents and close file stream</span>
	<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">czmlStr</span><span class="p">)</span>
	<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">VRV_SETTING_SHOWOUTPUTMESSAGE</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Message: Assignments (.czml) were written to </span><span class="si">%s</span><span class="s2"> ...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">czmlFilePath</span><span class="p">))</span>

	<span class="k">return</span>

<span class="k">def</span> <span class="nf">_writeAssignmentsJS</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">,</span> <span class="n">cesiumColor</span><span class="p">,</span> <span class="n">cesiumWeight</span><span class="p">,</span> <span class="n">cesiumStyle</span><span class="p">,</span> <span class="n">cesiumOpacity</span><span class="p">,</span> <span class="n">fullDir</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This script generates the displayPaths.js file</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	lstSubAssignments: list of :ref:`Assignments`</span>
<span class="sd">		A list of Assignments dataframe, each dataframe will have the same odID</span>
<span class="sd">	cesiumColor: string</span>
<span class="sd">		The color of arcs when displayed in Cesium. If provided, it will overrides the color in assignments dataframe. One of a collection of pre-specified colors. See :ref:`Cesium Style`</span>
<span class="sd">	cesiumWeight: int</span>
<span class="sd">		The weight of arcs when displayed in Cesium. If provided, it will overrides the weight in assignments dataframe. See :ref:`Cesium Style`</span>
<span class="sd">	cesiumStyle: string</span>
<span class="sd">		The style of arcs when displayed in Cesium. If provided, it will overrides the style in assignments dataframe. See :ref: `Cesium style`</span>
<span class="sd">	cesiumOpacity: string</span>
<span class="sd">		The opacity of arcs when displayed in Cesium. If provided, it will overrides the opacity in assignments dataframe. See :ref: `Cesium style`</span>
<span class="sd">	fullDir: string</span>
<span class="sd">		The directory of cesium, including the name of the instance.</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1"># .js file path</span>
	<span class="n">jsFilePath</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/displayPaths.js&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fullDir</span><span class="p">)</span>
	<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">jsFilePath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

	<span class="c1"># Head description</span>
	<span class="n">jsStr</span>  <span class="o">=</span>             <span class="s2">&quot;// This .js file is auto-generated by `createCesium` from VeRoViz</span><span class="se">\n</span><span class="s2">&quot;</span>
	<span class="n">jsStr</span> <span class="o">+=</span>             <span class="s2">&quot;// Display paths for cesium application</span><span class="se">\n\n</span><span class="s2">&quot;</span>

	<span class="c1"># Begin of the displayPaths function</span>
	<span class="n">jsStr</span> <span class="o">+=</span>             <span class="s2">&quot;function displayPaths() {</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="c1"># Collect all moving objects ID for path names</span>
	<span class="n">movingObjects</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">)):</span>
		<span class="n">newObjectID</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;objectID&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">newObjectID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">movingObjects</span><span class="p">):</span>
			<span class="n">movingObjects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newObjectID</span><span class="p">)</span>
	<span class="n">strMovingObjects</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">movingObjects</span><span class="p">)):</span>
		<span class="n">strMovingObjects</span> <span class="o">+=</span> <span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;, &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">movingObjects</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
	<span class="n">strMovingObjects</span> <span class="o">=</span> <span class="n">strMovingObjects</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
	<span class="n">jsStr</span> <span class="o">+=</span>             <span class="s2">&quot;    var pathNames = [</span><span class="si">%s</span><span class="s2">]; </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">strMovingObjects</span><span class="p">)</span>

	<span class="c1"># Register paths</span>
	<span class="n">jsStr</span> <span class="o">+=</span>             <span class="s2">&quot;    registerPaths(pathNames); </span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="c1"># For each `odID`, draw a polyline</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">)):</span>
		<span class="c1"># Get the lat/lon/alt for each waypoint, (polygon in 3D)</span>
		<span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
		<span class="n">assignmentLats</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">assignmentLons</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">assignmentAltMeters</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="n">assignmentLats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;startLat&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">assignmentLons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;startLon&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">assignmentAltMeters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;startAltMeters&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">assignmentLats</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;endLat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
		<span class="n">assignmentLons</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;endLon&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
		<span class="n">assignmentAltMeters</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;endAltMeters&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

		<span class="n">assignmentDimension</span> <span class="o">=</span> <span class="mi">3</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">assignmentAltMeters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">assignmentAltMeters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
			<span class="n">assignmentDimension</span> <span class="o">=</span> <span class="mi">2</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">assignmentDimension</span> <span class="o">=</span> <span class="mi">3</span>

		<span class="c1"># Check if cesium styles have been overrided, if not, assume that for entire path the style is the same</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cesiumColor</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
			<span class="n">color</span> <span class="o">=</span> <span class="n">cesiumColor</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">color</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;cesiumColor&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cesiumWeight</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
			<span class="n">weight</span> <span class="o">=</span> <span class="n">cesiumWeight</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">weight</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;cesiumWeight&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cesiumOpacity</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
			<span class="n">opacity</span> <span class="o">=</span> <span class="n">cesiumOpacity</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">opacity</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;cesiumOpacity&#39;</span><span class="p">]</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cesiumStyle</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">):</span>
			<span class="n">style</span> <span class="o">=</span> <span class="n">cesiumStyle</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">style</span> <span class="o">=</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;cesiumStyle&#39;</span><span class="p">]</span>

		<span class="k">try</span><span class="p">:</span>
			<span class="n">style</span> <span class="o">=</span> <span class="n">style</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
		<span class="k">except</span><span class="p">:</span>
			<span class="k">pass</span>
			
		<span class="k">if</span> <span class="p">(</span><span class="n">style</span> <span class="o">==</span> <span class="s1">&#39;dashed&#39;</span><span class="p">):</span>
			<span class="n">dashLength</span> <span class="o">=</span> <span class="mi">40</span>
		<span class="k">elif</span> <span class="p">(</span><span class="n">style</span> <span class="o">==</span> <span class="s1">&#39;dotted&#39;</span><span class="p">):</span>
			<span class="n">dashLength</span> <span class="o">=</span> <span class="mi">10</span>
		<span class="k">elif</span> <span class="p">(</span><span class="n">style</span> <span class="o">==</span> <span class="s1">&#39;solid&#39;</span><span class="p">):</span>
			<span class="n">dashLength</span> <span class="o">=</span> <span class="mi">0</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">assignmentDimension</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
			<span class="c1"># For each path, generate one polyline entity</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;    paths[</span><span class="si">%d</span><span class="s2">] = viewer.entities.add({</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;        parent: vehiclePolylines[&#39;</span><span class="si">%s</span><span class="s2">&#39;],</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;objectID&#39;</span><span class="p">])</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;        name: &#39;Objects </span><span class="si">%s</span><span class="s2">&#39;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;objectID&#39;</span><span class="p">])</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;        polyline: {</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            positions: Cesium.Cartesian3.fromDegreesArrayHeights([</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">assignmentLats</span><span class="p">)):</span>
				<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;                </span><span class="si">%f</span><span class="s2">, </span><span class="si">%f</span><span class="s2">, </span><span class="si">%f</span><span class="s2">, </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">assignmentLons</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">assignmentLats</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">assignmentAltMeters</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
			<span class="n">jsStr</span> <span class="o">=</span> <span class="n">jsStr</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            </span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            ]),</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            width: </span><span class="si">%d</span><span class="s2">, </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">weight</span><span class="p">)</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            material: new Cesium.PolylineDashMaterialProperty({</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;                dashLength: </span><span class="si">%f</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dashLength</span><span class="p">)</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;                color: </span><span class="si">%s</span><span class="s2">.withAlpha(</span><span class="si">%f</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            })</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;        }</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;    });</span><span class="se">\n</span><span class="s2">&quot;</span>
		<span class="k">elif</span> <span class="p">(</span><span class="n">assignmentDimension</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
			<span class="c1"># For each path, generate one polyline entity</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;    paths[</span><span class="si">%d</span><span class="s2">] = viewer.entities.add({</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;        parent: vehiclePolylines[&#39;</span><span class="si">%s</span><span class="s2">&#39;],</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;objectID&#39;</span><span class="p">])</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;        name: &#39;Objects </span><span class="si">%s</span><span class="s2">&#39;,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;objectID&#39;</span><span class="p">])</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;        polyline: {</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            positions: Cesium.Cartesian3.fromDegreesArray([</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">assignmentLats</span><span class="p">)):</span>
				<span class="n">jsStr</span> <span class="o">+=</span> <span class="s2">&quot;                </span><span class="si">%f</span><span class="s2">, </span><span class="si">%f</span><span class="s2">, </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">assignmentLons</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">assignmentLats</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
			<span class="n">jsStr</span> <span class="o">=</span> <span class="n">jsStr</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            </span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            ]),</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            clampToGround: true, </span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            width: </span><span class="si">%d</span><span class="s2">, </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">weight</span><span class="p">)</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            material: new Cesium.PolylineDashMaterialProperty({</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;                dashLength: </span><span class="si">%f</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dashLength</span><span class="p">)</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;                color: </span><span class="si">%s</span><span class="s2">.withAlpha(</span><span class="si">%f</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">opacity</span><span class="p">)</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;            })</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;        }</span><span class="se">\n</span><span class="s2">&quot;</span>
			<span class="n">jsStr</span> <span class="o">+=</span>     <span class="s2">&quot;    });</span><span class="se">\n</span><span class="s2">&quot;</span>

	<span class="c1"># End of the displayPaths function</span>
	<span class="n">jsStr</span> <span class="o">+=</span>             <span class="s2">&quot;}&quot;</span>

	<span class="c1"># Write contents and close file stream</span>
	<span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">jsStr</span><span class="p">)</span>
	<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">VRV_SETTING_SHOWOUTPUTMESSAGE</span><span class="p">):</span>
		<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Message: Assignments (.js) were written to </span><span class="si">%s</span><span class="s2"> ...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">jsFilePath</span><span class="p">))</span>

	<span class="k">return</span>

<span class="k">def</span> <span class="nf">_getCesiumTime</span><span class="p">(</span><span class="n">startDate</span><span class="p">,</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">timeSec</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	This script gives a JulianDate format time for cesium</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	startDate: string, format is &quot;YYYY-MM-DD&quot;, default as today</span>
<span class="sd">		The start date of the video generated</span>
<span class="sd">	startTime: string, format is &quot;HH:MM:SS&quot;, default as &#39;08:00:00&#39;</span>
<span class="sd">		The start time of the start date</span>
<span class="sd">	timeSec: float</span>
<span class="sd">		Time past after start time</span>

<span class="sd">	Return</span>
<span class="sd">	------</span>
<span class="sd">	JulianDate</span>
<span class="sd">		Time in JulianDate format</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1"># Set time zero</span>
	<span class="n">timeZero</span> <span class="o">=</span> <span class="n">dateutil</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">startDate</span><span class="p">,</span> <span class="n">startTime</span><span class="p">))</span>

	<span class="c1"># Return timeSec in cesium format (semi-Julian format)</span>
	<span class="n">cesiumTime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="n">timeZero</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">timeSec</span><span class="p">),</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">T%H:%M:%SZ&#39;</span><span class="p">)</span>

	<span class="k">return</span> <span class="n">cesiumTime</span>

<span class="k">def</span> <span class="nf">_getAction</span><span class="p">(</span><span class="n">subAssignments</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Give a group of assignments with same odID, find if this group is stationary/vertical/move, each will be treated differently in cesium and folium.</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	subAssignments: :ref:`Assignments`</span>
<span class="sd">		An assignment dataframe with the same odID</span>

<span class="sd">	Return</span>
<span class="sd">	------</span>
<span class="sd">	string</span>
<span class="sd">		An enumerate string, out put can be &#39;stationary&#39;/&#39;vertical&#39;/&#39;move&#39;</span>
<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1"># if it is static or vertical, there should (must) be one row for correspondence `odID`</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subAssignments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;startLat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;endLat&#39;</span><span class="p">]</span>
			<span class="ow">and</span> <span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;startLon&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;endLon&#39;</span><span class="p">]</span>
			<span class="ow">and</span> <span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;startAltMeters&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;endAltMeters&#39;</span><span class="p">]):</span>
			<span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;stationary&quot;</span>
		<span class="k">elif</span> <span class="p">(</span><span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;startLat&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;endLat&#39;</span><span class="p">]</span>
			<span class="ow">and</span> <span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;startLon&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;endLon&#39;</span><span class="p">]</span>
			<span class="ow">and</span> <span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;startAltMeters&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">subAssignments</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;endAltMeters&#39;</span><span class="p">]):</span>
			<span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;vertical&quot;</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;move&quot;</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">action</span> <span class="o">=</span> <span class="s2">&quot;move&quot;</span>

	<span class="k">return</span> <span class="n">action</span>

<span class="k">def</span> <span class="nf">_getPathsDetails</span><span class="p">(</span><span class="n">assignments</span><span class="p">):</span>

	<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">	Given an Assignments dataframe, this script deconstruct it into a list of assignments(or called subAssignments) each subAssignment will have: the same odID; same type of movement(stationary/vertical/move)</span>

<span class="sd">	Parameters</span>
<span class="sd">	----------</span>
<span class="sd">	assignments: :ref:`Assignments`, Required</span>
<span class="sd">		The Assignments dataframe to be deconstructed into lists</span>

<span class="sd">	Returns</span>
<span class="sd">	-------</span>
<span class="sd">	path: Path dataframe</span>
<span class="sd">		A list of description of each subAssignment</span>
<span class="sd">	lstSubAssignments: list of :ref:`Assignments`</span>
<span class="sd">		A list of Assignments dataframe each with the same odID</span>

<span class="sd">	&quot;&quot;&quot;</span>

	<span class="c1"># Icon list</span>
	<span class="n">modelWithDuplicates</span> <span class="o">=</span> <span class="n">assignments</span><span class="p">[</span><span class="s1">&#39;modelFile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
	<span class="n">uniqueIconList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">modelWithDuplicates</span><span class="p">))</span>

	<span class="c1"># Get path list from assignments dataframe</span>
	<span class="n">lstSubAssignments</span> <span class="o">=</span> <span class="n">deconstructAssignments</span><span class="p">(</span><span class="n">assignments</span><span class="o">=</span><span class="n">assignments</span><span class="p">,</span> <span class="n">includeStationaryFlag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">includeVerticalFlag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

	<span class="c1"># Now we prepare for .czml, the following is a Path Dataframe, which has the same length as lstSubAssignments</span>
	<span class="n">path</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;odID&#39;</span><span class="p">,</span> <span class="s1">&#39;czmlID&#39;</span><span class="p">,</span> <span class="s1">&#39;objectID&#39;</span><span class="p">,</span> <span class="s1">&#39;modelFile&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">,</span> <span class="s1">&#39;modelScale&#39;</span><span class="p">,</span> <span class="s1">&#39;modelMinPxSize&#39;</span><span class="p">,</span> <span class="s1">&#39;startTimeSec&#39;</span><span class="p">,</span> <span class="s1">&#39;endTimeSec&#39;</span><span class="p">,</span> <span class="s1">&#39;intervalStart&#39;</span><span class="p">,</span> <span class="s1">&#39;intervalEnd&#39;</span><span class="p">,</span> <span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">])</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">)):</span>
		<span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
			<span class="s1">&#39;odID&#39;</span><span class="p">:</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;odID&#39;</span><span class="p">],</span>
			<span class="s1">&#39;czmlID&#39;</span><span class="p">:</span> <span class="s1">&#39;o-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;objectID&#39;</span><span class="p">],</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;modelFile&#39;</span><span class="p">],</span> <span class="n">_getAction</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">])),</span>
			<span class="s1">&#39;objectID&#39;</span><span class="p">:</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;objectID&#39;</span><span class="p">],</span>
			<span class="s1">&#39;modelFile&#39;</span><span class="p">:</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;modelFile&#39;</span><span class="p">],</span>
			<span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">_getAction</span><span class="p">(</span><span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
			<span class="s1">&#39;modelScale&#39;</span><span class="p">:</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;modelScale&#39;</span><span class="p">],</span>
			<span class="s1">&#39;modelMinPxSize&#39;</span><span class="p">:</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;modelMinPxSize&#39;</span><span class="p">],</span>
			<span class="s1">&#39;startTimeSec&#39;</span><span class="p">:</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;startTimeSec&#39;</span><span class="p">],</span>
			<span class="s1">&#39;endTimeSec&#39;</span><span class="p">:</span> <span class="n">lstSubAssignments</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;endTimeSec&#39;</span><span class="p">],</span>
			<span class="s1">&#39;intervalStart&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
			<span class="s1">&#39;intervalEnd&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
			<span class="s1">&#39;indexInlstShapepoints&#39;</span><span class="p">:</span> <span class="n">i</span>
			<span class="p">},</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
	<span class="n">path</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;odID&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

	<span class="k">return</span> <span class="p">[</span><span class="n">path</span><span class="p">,</span> <span class="n">lstSubAssignments</span><span class="p">]</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">veroviz 0.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../veroviz.html" >veroviz</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, optimatorlab.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.1.2.
    </div>
  </body>
</html>